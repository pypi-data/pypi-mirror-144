"use strict";(self.webpackChunkatoti_jupyterlab=self.webpackChunkatoti_jupyterlab||[]).push([[1418],{91418:(e,t,a)=>{a.r(t),a.d(t,{default:()=>M});var n=a(8336),o=a(56271),s=a(39349),i=a(39030),r=a(94158),l=a(3440),u=a.n(l),d=a(87622),c=a.n(d),y=a(9439),p=a.n(y),x=a(53347),m=a(66611),v=a(37946),g=a(80877),C=a(93897),f=a(71249),h=a(21469),b=a(50654),E=a(95923);function k(e){return e.substring(5,e.length-1).split(",")}var N={name:"10bhair-QueryContextEntryTileCaption",styles:"display:flex;margin-right:16px;;label:QueryContextEntryTileCaption;"},w={name:"1hmgl6r-QueryContextEntryTileCaption",styles:"flex-grow:1;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;;label:QueryContextEntryTileCaption;"},T={name:"whkwzk-QueryContextEntryTileCaption",styles:"text-align:right;flex-grow:1;flex-shrink:1;margin-left:10px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;min-width:35px;;label:QueryContextEntryTileCaption;"};const Q=e=>{let t;const[a,s]=(0,o.useState)(null);if((0,o.useEffect)((()=>{"BOOL"!==e.type&&"ENUM"!==e.type&&s(e.value)}),[e.type,e.value]),"BOOL"===e.type)t=(0,n.jsx)(v.default,{checked:Boolean(e.value),disabled:e.isDisabled,onChange:()=>{var t;return null===(t=e.onValueChanged)||void 0===t?void 0:t.call(e,!e.value)}});else if(e.isDisabled)t=e.value;else if(e.type.startsWith("ENUM")){const a=k(e.type);t=(0,n.jsx)(C.Z,{value:e.value,size:"small",onChange:e.onValueChanged,disabled:e.isDisabled},a.map((e=>(0,n.jsx)(C.Z.Option,{key:e,value:e},e))))}else t=(0,n.jsx)(g.Z,{value:null!=a?a:"",onChange:e=>s(e.target.value),onBlur:t=>{const a=t.target.value;var n;isNaN(Number(a))&&"ALL"!==e.type||null===(n=e.onValueChanged)||void 0===n||n.call(e,a)},size:"small",disabled:e.isDisabled});return(0,n.jsx)("div",{css:N,key:e.name},(0,n.jsx)("div",{css:w,title:e.name},e.name),(0,n.jsx)("div",{css:T},t))};var j={name:"1etlk4r-QueryContextEntryEditionPopup",styles:"height:35px;display:flex;justify-content:flex-end;margin-top:8px;;label:QueryContextEntryEditionPopup;"},K={name:"hpxvrh-QueryContextEntryEditionPopup",styles:"&.ant-btn{margin-right:8px;};label:QueryContextEntryEditionPopup;"};const S=e=>{var t;const{formatMessage:a}=(0,s.useIntl)(),{onOk:i,onCancel:r,templatedName:l}=e,[u,d]=(0,o.useState)(""),[c,y]=(0,o.useState)(""),p=(e=>{const t=e.indexOf("$"),a=e.lastIndexOf("$");return e.substring(t,a+1)})(l),x=l.replace(p,u);return(0,n.jsx)("div",{style:{width:400,display:"flex",flexDirection:"column"}},(0,n.jsx)("div",{style:{flexGrow:1}},(0,n.jsx)(g.Z,{style:{marginTop:8},placeholder:p,value:u,onChange:e=>d(e.target.value)}),(0,n.jsx)(g.Z,{style:{marginTop:8},placeholder:"value",value:c,onChange:e=>y(e.target.value)})),(0,n.jsx)("div",{css:j},(0,n.jsx)(h.default,{css:K,onClick:r},a({id:"aui.cancel"})),(0,n.jsx)(h.default,{onClick:()=>{i(x,c)},disabled:0===u.length||0===c.length||(null===(t=e.queryContext)||void 0===t?void 0:t.some((({key:e})=>e===x))),type:"primary"},a({id:"aui.ok"}))))},O=["drillthrough.hiddencolumns","subcube"],q=["mdx.kpi","mdx.member","mdx.formatters","mdx.set","mdx.measureAlias","mdx.defaultmembers","user-authentication"],I=["dashboard","page","widget"],R=(e,{sectionName:t,pageKey:a,leafKey:n})=>{const o="dashboard"===t?e:"page"===t?(0,b.fx)(e,a):(0,b.LI)(e,a,n);if(!o)throw new Error(`Impossible to edit the ${t}'s query context, as its corresponding state was not found.`);return o},D=(e,t,a)=>{e.queryContext||(e.queryContext=[]),e.queryContext.splice(a,0,t)},V=({dashboardState:e,pageKey:t,leafKey:a,userQueryContext:n,sectionName:o,queryContextEntry:s,position:i})=>{let r=n,l=e;return"user"===o?r=(0,f.produce)(n,(e=>{e.splice(i,0,s)})):l=(0,f.produce)(e,(e=>{const n=R(e,{sectionName:o,pageKey:t,leafKey:a});D(n,s,i)})),[l,r]},_=(e,t)=>{if(!e.queryContext)return;const{queryContext:a}=e;a.splice(t,1),0===a.length&&delete e.queryContext},L=({dashboardState:e,pageKey:t,leafKey:a,userQueryContext:n,sectionName:o,position:s})=>{let i=n,r=e;return"user"===o?i=(0,f.produce)(n,(e=>{e.splice(s,1)})):r=(0,f.produce)(e,(e=>{const n=R(e,{sectionName:o,pageKey:t,leafKey:a});_(n,s)})),[r,i]},M=(0,i.r3)((e=>{const{dashboardState:t,pageKey:a,leafKey:l,onDashboardChange:d}=(0,m.F)(e)?e:{},{dataModel:y,widgetState:v,onWidgetChange:g}=e,{formatMessage:C}=(0,s.useIntl)(),[h]=(0,E.yu)("userQueryContext.isEnabled");let b=I;h&&(b=["user",...I]);const N=(0,i.cQ)(v,t,a),[,w]=(0,E.XP)("userQueryContext"),[T,j]=(0,o.useState)(null),K=(0,o.useMemo)((()=>c()(y.contextValues,"name")),[y.contextValues]),M=(0,o.useCallback)((e=>{if(K[e])return K[e].type;const t=p()(K,(({name:t})=>e.startsWith(t.replace(/\$.*\$$/,""))));return t?K[t].type:"ALL"}),[K]),P=(0,o.useMemo)((()=>{const e=y.contextValues.filter((({name:e})=>!O.some((t=>e.startsWith(t))))),t=u()(e,(({category:e})=>e||"misc"));return Object.keys(t).map((e=>({caption:e,isFolder:!0,isActionable:!1,type:e,children:t[e].map((t=>{const a={type:"QUERY_CONTEXT_ENTRY",key:t.name};return{caption:t.name,type:e,isActionable:!0,isDisabled:b.every((e=>{var a;return null===(a=N[e])||void 0===a?void 0:a.some((({key:e})=>e===t.name))})),dragItem:a}}))})))}),[y.contextValues,N,b]),Y=(0,o.useMemo)((()=>{const o={};return o.default={caption:C({id:"aui.drawer.queryContextEditor.defaultSection"}),tiles:e.cube.contextValues.filter((({name:e})=>q.every((t=>!e.startsWith(t)))&&O.every((t=>!e.startsWith(t))))).map((({name:e,value:t},a)=>{const o={key:e,value:t,originSection:"default",originPosition:a,type:"QUERY_CONTEXT_ENTRY"};return{caption:(0,n.jsx)(Q,{name:e,value:t,isDisabled:!0,type:M(e)}),dragItem:o,isEditable:!1,isDisabled:b.some((t=>{var a;return null===(a=N[t])||void 0===a?void 0:a.some((({key:t})=>t===e))})),isRemovable:!1}}))},b.forEach((e=>{const s=N[e];o[e]={caption:C({id:`aui.drawer.queryContextEditor.${e}Section`}),tiles:s?s.map((({key:o,value:s},i)=>{const r={key:o,value:s,originSection:e,originPosition:i,type:"QUERY_CONTEXT_ENTRY"},u=b.slice(b.indexOf(e)+1).some((e=>{var t;return null===(t=N[e])||void 0===t?void 0:t.some((e=>o===e.key))}));return{caption:(0,n.jsx)(Q,{name:o,value:s,type:M(o),isDisabled:u,onValueChanged:n=>{if(d&&t&&a&&l)if("user"===e){if(!N.user)return;const e=(0,f.produce)(N.user,(e=>{e[i].value=n}));w(e)}else{const o=(0,f.produce)(t,(t=>{R(t,{leafKey:l,pageKey:a,sectionName:e}).queryContext[i].value=n}));d(o)}else{const e=(0,f.produce)(v,(e=>{e.queryContext[i].value=n}));g(e)}}}),isEditable:!1,isRemovable:!0,isDisabled:u,dragItem:r}})):[]}})),T&&o[T.sectionName].tiles.splice(T.tileIndex,0,{caption:T.key,dragItem:null}),o}),[T,M,e.cube.contextValues,N,t,C,l,d,g,a,v,w,b]),U=(0,o.useCallback)(((e,n)=>{if(d&&t&&a&&l){const[o,s]=L({dashboardState:t,pageKey:a,leafKey:l,userQueryContext:N.user||[],sectionName:e,position:n});o!==t&&d(o),s!==N.user&&w(s)}else{const e=(0,f.produce)(v,(e=>{_(e,n)}));g(e)}}),[t,l,d,a,N.user,v,g,w]),A=(0,o.useCallback)(((n,o,s)=>{var i;const r=null!=s?s:(null===(i=N[n])||void 0===i?void 0:i.length)||0;if(-1!==o.indexOf("$"))j({tileIndex:r,sectionName:n,key:o});else{const s={key:o,value:((e,t)=>{if(!e)return"";const a=t.find((({name:t})=>t===e.name));if(e.type.startsWith("ENUM"))return k(e.type)[0];switch(e.type){case"BOOL":return void 0===a||Boolean(a.value);case"LONG":case"INTEGER":case"DOUBLE":return void 0!==a?Number(a.value):0;default:return(null==a?void 0:a.value)||""}})(K[o],e.cube.contextValues)};if(d&&t&&a&&l){const[e,o]=V({dashboardState:t,pageKey:a,leafKey:l,userQueryContext:N.user||[],sectionName:n,queryContextEntry:s,position:r});e!==t&&d(e),o!==N.user&&w(o)}else{const e=(0,f.produce)(v,(e=>{D(e,s,r)}));g(e)}}}),[K,t,l,d,g,a,N,v,e.cube.contextValues,w]),$=(0,o.useCallback)((e=>{var t;e.isActionable&&!(null===(t=N.widget)||void 0===t?void 0:t.some((({key:t})=>t===e.caption)))&&A("widget",e.caption)}),[A,N]),B=(0,o.useCallback)(((e,n)=>{if(T){const o={key:e,value:n};if(d&&t&&a&&l){const[e,n]=V({dashboardState:t,pageKey:a,leafKey:l,userQueryContext:N.user||[],sectionName:T.sectionName,queryContextEntry:o,position:T.tileIndex});e!==t&&d(e),n!==N.user&&w(n)}else{const e=(0,f.produce)(v,(e=>{D(e,o,T.tileIndex)}));g(e)}j(null)}}),[t,l,d,g,a,T,v,w,N.user]),W=(0,o.useCallback)(((e,n,o)=>{if(d&&t&&a&&l){var s;let i=t,r=null!==(s=N.user)&&void 0!==s?s:[];"default"!==n.originSection&&([i,r]=L({dashboardState:t,pageKey:a,leafKey:l,userQueryContext:N.user||[],sectionName:n.originSection,position:n.originPosition})),"default"!==e&&([i,r]=V({dashboardState:i,pageKey:a,leafKey:l,userQueryContext:r||[],sectionName:e,position:o,queryContextEntry:{key:n.key,value:n.value}})),i!==t&&d(i),r!==N.user&&w(r)}}),[t,l,d,a,w,N.user]),X=(0,o.useCallback)(((e,t,a)=>{A(e,t.key,a)}),[A]);return(0,n.jsx)(i.A3,null,(0,n.jsx)(r.mp,{value:P,isSearchVisible:!0,searchPlaceholder:C({id:"aui.drawer.queryContextEditor.searchContextEntries"}),onClick:$}),(0,n.jsx)(x.e,{sections:Y,dragItemTypes:["QUERY_CONTEXT_ENTRY"],canDrop:(e,t)=>{var a;return!("QUERY_CONTEXT_ENTRY"!==t.type||"default"===e||t.originSection&&t.originSection===e||(null===(a=N[e])||void 0===a?void 0:a.some((({key:e})=>e===t.key))))},placeholder:C({id:"aui.drawer.queryContextEditor.noQueryContextEntries"}),onTileRemoved:U,onTileMoved:W,onTileAdded:X,popoverPosition:T,popover:T&&(0,n.jsx)(S,{onOk:B,templatedName:T.key,onCancel:()=>j(null),queryContext:N[T.sectionName]}),popoverInnerHeight:110}))}))}}]);