"use strict";(self.webpackChunk_tiledb_inc_pybabylonjs=self.webpackChunk_tiledb_inc_pybabylonjs||[]).push([[856],{856:(e,t,r)=>{r.r(t),r.d(t,{GLTF1:()=>s.ms,GLTF2:()=>s.VW,GLTFFileLoader:()=>s.ey,GLTFLoaderAnimationStartMode:()=>s.B2,GLTFLoaderCoordinateSystemMode:()=>s.em,GLTFLoaderState:()=>s.zA,GLTFValidation:()=>s.JM,MTLFileLoader:()=>a,OBJFileLoader:()=>d,STLFileLoader:()=>_});var s=r(4044),n=r(8362),i=r(1277),o=r(1330),a=function(){function e(){this.materials=[]}return e.prototype.parseMTL=function(t,r,s,i){if(!(r instanceof ArrayBuffer)){for(var a,l=r.split("\n"),p=/\s+/,u=null,h=0;h<l.length;h++){var m=l[h].trim();if(0!==m.length&&"#"!==m.charAt(0)){var c=m.indexOf(" "),f=c>=0?m.substring(0,c):m;f=f.toLowerCase();var d=c>=0?m.substring(c+1).trim():"";"newmtl"===f?(u&&this.materials.push(u),t._blockEntityCollection=i,u=new o.K(d,t),t._blockEntityCollection=!1):"kd"===f&&u?(a=d.split(p,3).map(parseFloat),u.diffuseColor=n.Wo.FromArray(a)):"ka"===f&&u?(a=d.split(p,3).map(parseFloat),u.ambientColor=n.Wo.FromArray(a)):"ks"===f&&u?(a=d.split(p,3).map(parseFloat),u.specularColor=n.Wo.FromArray(a)):"ke"===f&&u?(a=d.split(p,3).map(parseFloat),u.emissiveColor=n.Wo.FromArray(a)):"ns"===f&&u?u.specularPower=parseFloat(d):"d"===f&&u?u.alpha=parseFloat(d):"map_ka"===f&&u?u.ambientTexture=e._getTexture(s,d,t):"map_kd"===f&&u?u.diffuseTexture=e._getTexture(s,d,t):"map_ks"===f&&u?u.specularTexture=e._getTexture(s,d,t):"map_ns"===f||("map_bump"===f&&u?u.bumpTexture=e._getTexture(s,d,t):"map_d"===f&&u&&(u.opacityTexture=e._getTexture(s,d,t)))}}u&&this.materials.push(u)}},e._getTexture=function(t,r,s){if(!r)return null;var n=t;if("file:"===t){var o=r.lastIndexOf("\\");-1===o&&(o=r.lastIndexOf("/")),n+=o>-1?r.substr(o+1):r}else n+=r;return new i.x(n,s,!1,e.INVERT_TEXTURE_Y)},e.INVERT_TEXTURE_Y=!0,e}(),l=r(2973),p=r(8810),u=r(128),h=r(3953),m=r(2131),c=r(7595),f=r(4518),d=function(){function e(t){this.name="obj",this.extensions=".obj",this.obj=/^o/,this.group=/^g/,this.mtllib=/^mtllib /,this.usemtl=/^usemtl /,this.smooth=/^s /,this.vertexPattern=/v(\s+[\d|\.|\+|\-|e|E]+){3,7}/,this.normalPattern=/vn(\s+[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,this.uvPattern=/vt(\s+[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,this.facePattern1=/f\s+(([\d]{1,}[\s]?){3,})+/,this.facePattern2=/f\s+((([\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,this.facePattern3=/f\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,this.facePattern4=/f\s+((([\d]{1,}\/\/[\d]{1,}[\s]?){3,})+)/,this.facePattern5=/f\s+(((-[\d]{1,}\/-[\d]{1,}\/-[\d]{1,}[\s]?){3,})+)/,this._forAssetContainer=!1,this._meshLoadOptions=t||e.currentMeshLoadOptions}return Object.defineProperty(e,"INVERT_TEXTURE_Y",{get:function(){return a.INVERT_TEXTURE_Y},set:function(e){a.INVERT_TEXTURE_Y=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"currentMeshLoadOptions",{get:function(){return{ComputeNormals:e.COMPUTE_NORMALS,ImportVertexColors:e.IMPORT_VERTEX_COLORS,InvertY:e.INVERT_Y,InvertTextureY:e.INVERT_TEXTURE_Y,UVScaling:e.UV_SCALING,MaterialLoadingFailsSilently:e.MATERIAL_LOADING_FAILS_SILENTLY,OptimizeWithUV:e.OPTIMIZE_WITH_UV,SkipMaterials:e.SKIP_MATERIALS}},enumerable:!1,configurable:!0}),e.prototype._loadMTL=function(e,t,r,s){var n=p.w1.BaseUrl+t+e;p.w1.LoadFile(n,r,void 0,void 0,!1,(function(e,t){s(n,t)}))},e.prototype.createPlugin=function(){return new e(e.currentMeshLoadOptions)},e.prototype.canDirectLoad=function(e){return!1},e.prototype.importMeshAsync=function(e,t,r,s,n,i){return this._parseSolid(e,t,r,s).then((function(e){return{meshes:e,particleSystems:[],skeletons:[],animationGroups:[],transformNodes:[],geometries:[],lights:[]}}))},e.prototype.loadAsync=function(e,t,r,s,n){return this.importMeshAsync(null,e,t,r,s).then((function(){}))},e.prototype.loadAssetContainerAsync=function(e,t,r,s,n){var i=this;return this._forAssetContainer=!0,this.importMeshAsync(null,e,t,r).then((function(t){var r=new f.TJ(e);return t.meshes.forEach((function(e){return r.meshes.push(e)})),t.meshes.forEach((function(e){var t=e.material;t&&-1==r.materials.indexOf(t)&&(r.materials.push(t),t.getActiveTextures().forEach((function(e){-1==r.textures.indexOf(e)&&r.textures.push(e)})))})),i._forAssetContainer=!1,r})).catch((function(e){throw i._forAssetContainer=!1,e}))},e.prototype._parseSolid=function(t,r,s,i){for(var o,c=this,f=[],d=[],v=[],_=[],g=[],x=[],L=[],I=[],T=[],y=[],E=[],A=0,F=!1,O=[],P=[],b=[],C=[],M=[],w="",S="",V=new a,N=1,R=!0,U=new n.HE(.5,.5,.5,1),k=function(e,t,r,s,n,i,o){var a;-1===(a=c._meshLoadOptions.OptimizeWithUV?function(e,t){e[t[0]]||(e[t[0]]={normals:[],idx:[],uv:[]});var r=e[t[0]].normals.indexOf(t[1]);return 1!=r&&t[2]===e[t[0]].uv[r]?e[t[0]].idx[r]:-1}(E,[e,r,t]):function(e,t){e[t[0]]||(e[t[0]]={normals:[],idx:[]});var r=e[t[0]].normals.indexOf(t[1]);return-1===r?-1:e[t[0]].idx[r]}(E,[e,r]))?(x.push(L.length),L.push(s),I.push(n),y.push(i),void 0!==o&&T.push(o),E[e].normals.push(r),E[e].idx.push(A++),c._meshLoadOptions.OptimizeWithUV&&E[e].uv.push(t)):x.push(a)},G=function(){for(var e=0;e<L.length;e++)O.push(L[e].x,L[e].y,L[e].z),b.push(y[e].x,y[e].y,y[e].z),C.push(I[e].x,I[e].y),!0===c._meshLoadOptions.ImportVertexColors&&P.push(T[e].r,T[e].g,T[e].b,T[e].a);L=[],y=[],I=[],T=[],E=[],A=0},W=function(e,t){for(var r=t;r<e.length-1;r++)M.push(e[0],e[r],e[r+1])},Y=function(e,t){W(e,t);for(var r=0;r<M.length;r++){var s=parseInt(M[r])-1;k(s,0,0,f[s],l.FM.Zero(),l.P.Up(),!0===c._meshLoadOptions.ImportVertexColors?_[s]:void 0)}M=[]},j=function(e,t){W(e,t);for(var r=0;r<M.length;r++){var s=M[r].split("/"),n=parseInt(s[0])-1,i=parseInt(s[1])-1;k(n,i,0,f[n],v[i],l.P.Up(),!0===c._meshLoadOptions.ImportVertexColors?_[n]:void 0)}M=[]},K=function(e,t){W(e,t);for(var r=0;r<M.length;r++){var s=M[r].split("/"),n=parseInt(s[0])-1,i=parseInt(s[1])-1,o=parseInt(s[2])-1;k(n,i,o,f[n],v[i],d[o])}M=[]},B=function(e,t){W(e,t);for(var r=0;r<M.length;r++){var s=M[r].split("//"),n=parseInt(s[0])-1,i=parseInt(s[1])-1;k(n,1,i,f[n],l.FM.Zero(),d[i],!0===c._meshLoadOptions.ImportVertexColors?_[n]:void 0)}M=[]},D=function(e,t){W(e,t);for(var r=0;r<M.length;r++){var s=M[r].split("/"),n=f.length+parseInt(s[0]),i=v.length+parseInt(s[1]),o=d.length+parseInt(s[2]);k(n,i,o,f[n],v[i],d[o],!0===c._meshLoadOptions.ImportVertexColors?_[n]:void 0)}M=[]},X=function(){g.length>0&&(o=g[g.length-1],G(),x.reverse(),o.indices=x.slice(),o.positions=O.slice(),o.normals=b.slice(),o.uvs=C.slice(),!0===c._meshLoadOptions.ImportVertexColors&&(o.colors=P.slice()),x=[],O=[],P=[],b=[],C=[])},z=s.split("\n"),Z=0;Z<z.length;Z++){var H,J=z[Z].trim().replace(/\s\s/g," ");if(0!==J.length&&"#"!==J.charAt(0))if(this.vertexPattern.test(J))H=J.match(/[^ ]+/g),f.push(new l.P(parseFloat(H[1]),parseFloat(H[2]),parseFloat(H[3]))),!0===this._meshLoadOptions.ImportVertexColors&&(H.length>=7?_.push(new n.HE(parseFloat(H[4]),parseFloat(H[5]),parseFloat(H[6]),7===H.length||void 0===H[7]?1:parseFloat(H[7]))):_.push(U));else if(null!==(H=this.normalPattern.exec(J)))d.push(new l.P(parseFloat(H[1]),parseFloat(H[2]),parseFloat(H[3])));else if(null!==(H=this.uvPattern.exec(J)))v.push(new l.FM(parseFloat(H[1])*e.UV_SCALING.x,parseFloat(H[2])*e.UV_SCALING.y));else if(null!==(H=this.facePattern3.exec(J)))K(H[1].trim().split(" "),1);else if(null!==(H=this.facePattern4.exec(J)))B(H[1].trim().split(" "),1);else if(null!==(H=this.facePattern5.exec(J)))D(H[1].trim().split(" "),1);else if(null!==(H=this.facePattern2.exec(J)))j(H[1].trim().split(" "),1);else if(null!==(H=this.facePattern1.exec(J)))Y(H[1].trim().split(" "),1);else if(this.group.test(J)||this.obj.test(J)){var q={name:J.substring(2).trim(),indices:void 0,positions:void 0,normals:void 0,uvs:void 0,colors:void 0,materialName:""};X(),g.push(q),F=!0,R=!0,N=1}else this.usemtl.test(J)?(w=J.substring(7).trim(),R&&F||(X(),q={name:"mesh_mm"+N.toString(),indices:void 0,positions:void 0,normals:void 0,uvs:void 0,colors:void 0,materialName:w},N++,g.push(q),F=!0),F&&R&&(g[g.length-1].materialName=w,R=!1)):this.mtllib.test(J)?S=J.substring(7).trim():this.smooth.test(J)||console.log("Unhandled expression at line : "+J)}F&&(o=g[g.length-1],x.reverse(),G(),o.indices=x,o.positions=O,o.normals=b,o.uvs=C,!0===this._meshLoadOptions.ImportVertexColors&&(o.colors=P)),F||(x.reverse(),G(),g.push({name:h.Z.RandomId(),indices:x,positions:O,colors:P,normals:b,uvs:C,materialName:w}));for(var Q=[],$=new Array,ee=0;ee<g.length;ee++){if(t&&g[ee].name)if(t instanceof Array){if(-1===t.indexOf(g[ee].name))continue}else if(g[ee].name!==t)continue;o=g[ee],r._blockEntityCollection=this._forAssetContainer;var te=new m.Kj(g[ee].name,r);r._blockEntityCollection=!1,$.push(g[ee].materialName);var re=new u.x;if(re.uvs=o.uvs,re.indices=o.indices,re.positions=o.positions,!0===this._meshLoadOptions.ComputeNormals){var se=new Array;u.x.ComputeNormals(o.positions,o.indices,se),re.normals=se}else re.normals=o.normals;!0===this._meshLoadOptions.ImportVertexColors&&(re.colors=o.colors),re.applyToMesh(te),this._meshLoadOptions.InvertY&&(te.scaling.y*=-1),Q.push(te)}var ne=[];return""!==S&&!1===this._meshLoadOptions.SkipMaterials&&ne.push(new Promise((function(e,t){c._loadMTL(S,i,(function(s){try{V.parseMTL(r,s,i,c._forAssetContainer);for(var n=0;n<V.materials.length;n++){for(var o,a=0,l=[];(o=$.indexOf(V.materials[n].name,a))>-1;)l.push(o),a=o+1;if(-1===o&&0===l.length)V.materials[n].dispose();else for(var u=0;u<l.length;u++)Q[l[u]].material=V.materials[n]}e()}catch(r){p.w1.Warn("Error processing MTL file: '"+S+"'"),c._meshLoadOptions.MaterialLoadingFailsSilently?e():t(r)}}),(function(r,s){p.w1.Warn("Error downloading MTL file: '"+S+"'"),c._meshLoadOptions.MaterialLoadingFailsSilently?e():t(s)}))}))),Promise.all(ne).then((function(){return Q}))},e.OPTIMIZE_WITH_UV=!0,e.INVERT_Y=!1,e.IMPORT_VERTEX_COLORS=!1,e.COMPUTE_NORMALS=!1,e.UV_SCALING=new l.FM(1,1),e.SKIP_MATERIALS=!1,e.MATERIAL_LOADING_FAILS_SILENTLY=!0,e}();c.n&&c.n.RegisterPlugin(new d);var v=r(6738),_=function(){function e(){this.solidPattern=/solid (\S*)([\S\s]*?)endsolid[ ]*(\S*)/g,this.facetsPattern=/facet([\s\S]*?)endfacet/g,this.normalPattern=/normal[\s]+([\-+]?[0-9]+\.?[0-9]*([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+/g,this.vertexPattern=/vertex[\s]+([\-+]?[0-9]+\.?[0-9]*([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+/g,this.name="stl",this.extensions={".stl":{isBinary:!0}}}return e.prototype.importMesh=function(e,t,r,s,n,i,o){var a;if("string"!=typeof r){if(this._isBinary(r)){var l=new m.Kj("stlmesh",t);return this._parseBinary(l,r),n&&n.push(l),!0}for(var u=new Uint8Array(r),h="",c=0;c<r.byteLength;c++)h+=String.fromCharCode(u[c]);r=h}for(;a=this.solidPattern.exec(r);){var f=a[1];if(f!=a[3])return p.w1.Error("Error in STL, solid name != endsolid name"),!1;if(e&&f)if(e instanceof Array){if(!e.indexOf(f))continue}else if(f!==e)continue;f=f||"stlmesh",l=new m.Kj(f,t),this._parseASCII(l,a[2]),n&&n.push(l)}return!0},e.prototype.load=function(e,t,r){return this.importMesh(null,e,t,r,null,null,null)},e.prototype.loadAssetContainer=function(e,t,r,s){var n=new f.TJ(e);return e._blockEntityCollection=!0,this.importMesh(null,e,t,r,n.meshes,null,null),e._blockEntityCollection=!1,n},e.prototype._isBinary=function(e){var t;if(84+50*(t=new DataView(e)).getUint32(80,!0)===t.byteLength)return!0;for(var r=t.byteLength,s=0;s<r;s++)if(t.getUint8(s)>127)return!0;return!1},e.prototype._parseBinary=function(e,t){for(var r=new DataView(t),s=r.getUint32(80,!0),n=0,i=new Float32Array(3*s*3),o=new Float32Array(3*s*3),a=new Uint32Array(3*s),l=0,p=0;p<s;p++){for(var u=84+50*p,h=r.getFloat32(u,!0),m=r.getFloat32(u+4,!0),c=r.getFloat32(u+8,!0),f=1;f<=3;f++){var d=u+12*f;i[n]=r.getFloat32(d,!0),i[n+2]=r.getFloat32(d+4,!0),i[n+1]=r.getFloat32(d+8,!0),o[n]=h,o[n+2]=m,o[n+1]=c,n+=3}a[l]=l++,a[l]=l++,a[l]=l++}e.setVerticesData(v.o.PositionKind,i),e.setVerticesData(v.o.NormalKind,o),e.setIndices(a),e.computeWorldMatrix(!0)},e.prototype._parseASCII=function(e,t){for(var r,s=[],n=[],i=[],o=0;r=this.facetsPattern.exec(t);){var a=r[1],l=this.normalPattern.exec(a);if(this.normalPattern.lastIndex=0,l){for(var p,u=[Number(l[1]),Number(l[5]),Number(l[3])];p=this.vertexPattern.exec(a);)s.push(Number(p[1]),Number(p[5]),Number(p[3])),n.push(u[0],u[1],u[2]);i.push(o++,o++,o++),this.vertexPattern.lastIndex=0}}this.facetsPattern.lastIndex=0,e.setVerticesData(v.o.PositionKind,s),e.setVerticesData(v.o.NormalKind,n),e.setIndices(i),e.computeWorldMatrix(!0)},e}();c.n&&c.n.RegisterPlugin(new _)}}]);